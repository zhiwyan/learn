## linux文件系统分析

### 逻辑io和物理io的区别

- 逻辑io：由应用程序发给文件系统的io
- 物理io：由文件系统发给磁盘的io，或者应用程序直接发给磁盘的io

### 随机io和连续io的区别

- 随机io文件偏移量的位置是随机的；
- 连续io文件偏移量的位置是相连的，提高读写性能

### 直接io及目的

- 应用程序绕过缓存使用文件系统，类似同步写。
- 直接io可以用于备份文件系统的应用程序，防止只读一次的数据污染文件系统缓存。
- 直接io也可以用于在进程堆中自建缓存应用，避免双重缓存的问题。

### 非阻塞io

- 在读写时返回错误代码，让应用程序过一会再重试，而不是让线程阻塞。

### VFS职责

- 虚拟文件系统给不同的文件系统提供了一个通用接口

### 文件系统延时

- 一个文件系统逻辑请求从开始到结束的实践，包括消耗在文件系统、内核磁盘io子系统和等待磁盘设备的时间。

### 预取（预读）的目的

- 在大量的文件顺序读io时，例如文件系统备份，这种数据量可能太大了，放不进缓存，或者只读一次在缓存留不住，造成缓存命中率偏低，系统性能较差。
- 预取是解决这类问题的通常做法。具体是：检查当前和上一个io的文件偏移量，可以检测出当前是否是顺序读负载，并作出预测，在应用程序请求前向磁盘发出读命令，以填充文件系统缓存。当应用程序真的发出读请求时，就会命中缓存，从而提高读的效率。

### fsync()相对O_SYNC的优势

- O_SYNC是单词同步写，fsync()是一组已写io的同步提交，同步提交之前异步写入数据，通过合并同步写提高性能。

### mmap()相对read()/write()的优势和劣势

- mmap内存文件映射，通过把文件映射到进程地址空间，并直接存取内存地址的方法来提高文件系统的io性能。避免了read()/write()操作产生的系统调用和上下文切换。
- 但在多处理器系统上，映射文件的缺点在于同步每个CPU MMU的开销，尤其是跨CPU的映射删除调用。